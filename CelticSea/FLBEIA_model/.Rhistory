# 00_Setup ####
gc()
rm(list = ls())
library(readxl)
library(tidyr)
library(dplyr)
library(icesTAF)
library(ggplot2)
Data_path <- "CelticSea/bootstrap"
Data_path_out <- "CelticSea/Results"
#NB gitignore this file as it is too big
intercatch_with_dist <-  read.csv(file = file.path(Data_path,"data/ices_intercatch/2021 06 24 WGMIXFISH CANUM WECA for stocks with distributions all WG 2002 2020.csv"),fileEncoding = "UTF-8-BOM")
taf.unzip("CelticSea/bootstrap/data/ices_intercatch/2021 06 24 WGMIXFISH CANUM WECA for stocks with distributions all WG 2002 2020.zip",
files="2021 06 24 WGMIXFISH CANUM WECA for stocks with distributions all WG 2002 2020.csv",
exdir="CelticSea/bootstrap/data/ices_intercatch")
taf.unzip("bootstrap/data/ices_intercatch/2021 06 24 WGMIXFISH CANUM WECA for stocks with distributions all WG 2002 2020.zip",
files="2021 06 24 WGMIXFISH CANUM WECA for stocks with distributions all WG 2002 2020.csv",
exdir="CelticSea/bootstrap/data/ices_intercatch")
getwd()
taf.unzip("/bootstrap/data/ices_intercatch/2021 06 24 WGMIXFISH CANUM WECA for stocks with distributions all WG 2002 2020.zip",
files="2021 06 24 WGMIXFISH CANUM WECA for stocks with distributions all WG 2002 2020.csv",
exdir="CelticSea/bootstrap/data/ices_intercatch")
gc()
rm(list = ls())
library(readxl)
library(tidyr)
library(dplyr)
library(icesTAF)
library(ggplot2)
Data_path <- "CelticSea/bootstrap"
Data_path_out <- "CelticSea/Results"
taf.unzip("/bootstrap/data/2019 06 22 WGMIXFISH CANUM WECA for stocks with distributions all WG 2002 2019.zip",
files="2019 06 22 WGMIXFISH CANUM WECA for stocks with distributions all WG 2002 2019.csv",
exdir="CelticSea/bootstrap/data/ices_intercatch")
taf.unzip("bootstrap/data/2019 06 22 WGMIXFISH CANUM WECA for stocks with distributions all WG 2002 2019.zip",
files="2019 06 22 WGMIXFISH CANUM WECA for stocks with distributions all WG 2002 2019.csv",
exdir="CelticSea/bootstrap/data/ices_intercatch")
taf.unzip("../bootstrap/data/2019 06 22 WGMIXFISH CANUM WECA for stocks with distributions all WG 2002 2019.zip",
files="2019 06 22 WGMIXFISH CANUM WECA for stocks with distributions all WG 2002 2019.csv",
exdir="CelticSea/bootstrap/data/ices_intercatch")
getwd()
taf.unzip(".bootstrap/data/ices_intercatch/2019 06 22 WGMIXFISH CANUM WECA for stocks with distributions all WG 2002 2019.zip",
files="2019 06 22 WGMIXFISH CANUM WECA for stocks with distributions all WG 2002 2019.csv",
exdir="CelticSea/bootstrap/data/ices_intercatch")
taf.unzip("bootstrap/data/ices_intercatch/2019 06 22 WGMIXFISH CANUM WECA for stocks with distributions all WG 2002 2019.zip",
files="2019 06 22 WGMIXFISH CANUM WECA for stocks with distributions all WG 2002 2019.csv",
exdir="CelticSea/bootstrap/data/ices_intercatch")
#NB gitignore this file as it is too big
intercatch_with_dist <-  read.csv(file = file.path(Data_path,"data/2019 06 22 WGMIXFISH CANUM WECA for stocks with distributions all WG 2002 2019.csv"),fileEncoding = "UTF-8-BOM")
#NB gitignore this file as it is too big
intercatch_with_dist <-  read.csv(file = file.path(Data_path,"data/ices_intercatch/2019 06 22 WGMIXFISH CANUM WECA for stocks with distributions all WG 2002 2019.csv"),fileEncoding = "UTF-8-BOM")
#NB gitignore this file as it is too big
intercatch_with_dist <-  read.csv("data/ices_intercatch/2019 06 22 WGMIXFISH CANUM WECA for stocks with distributions all WG 2002 2019.csv")
#NB gitignore this file as it is too big
intercatch_with_dist <-  read.csv("bootstrap/data/ices_intercatch/2019 06 22 WGMIXFISH CANUM WECA for stocks with distributions all WG 2002 2019.csv")
getwD()
getwd()
taf.unzip("bootstrap/data/ices_intercatch/2019 06 22 WGMIXFISH CANUM WECA for stocks with distributions all WG 2002 2019.zip",
files="2019 06 22 WGMIXFISH CANUM WECA for stocks with distributions all WG 2002 2019.csv",
exdir="CelticSea/bootstrap/data/ices_intercatch")
#NB gitignore this file as it is too big
intercatch_with_dist <-  read.csv("bootstrap/data/ices_intercatch/2019 06 22 WGMIXFISH CANUM WECA for stocks with distributions all WG 2002 2019.csv")
Data_path <- "CelticSea/bootstrap"
Data_path_out <- "CelticSea/Results"
#NB gitignore this file as it is too big
intercatch_with_dist <-  read.csv(file = file.path(Data_path,"data/ices_intercatch/2019 06 22 WGMIXFISH CANUM WECA for stocks with distributions all WG 2002 2019.csv"),fileEncoding = "UTF-8-BOM")
intercatch_with_dist2 <- intercatch_with_dist %>% filter(Area %in% c("27.7"  , "27.7.b" , "27.7.c","27.7.c.1","27.7.c.2" , "27.7.d",  "27.7.e",  "27.7.f" , "27.7.g" , "27.7.h",  "27.7.j","27.7.j.1","27.7.j.2" , "27.7.k","27.7.k.1","27.7.k.2" ))
#check for missing areas
check <- intercatch_with_dist %>% filter(!Area %in% c("27.7"  , "27.7.b" , "27.7.c","27.7.c.1","27.7.c.2" , "27.7.d",  "27.7.e",  "27.7.f" , "27.7.g" , "27.7.h",  "27.7.j","27.7.j.1","27.7.j.2" , "27.7.k","27.7.k.1","27.7.k.2" ))
unique(check$Area)
rm(check)
# Apply universal fixed from Lookup tabel ---------------------------------
table(intercatch_with_dist2$Country)
###CHECK THIS EACH YEAR (you have been warned)
intercatch_with_dist <- intercatch_with_dist2
intercatch_with_dist$Species <- toupper(substr(intercatch_with_dist$Stock,1,3))
#create an extra colum for lvl4
intercatch_with_dist$lvl4 <- substr(intercatch_with_dist$Fleet,1,7)
Country_Lookup <- read_xlsx("CelticSea/FLBEIA_model/lookup/Country_lookup.xlsx")
lvl4_Lookup <- read_xlsx("CelticSea/FLBEIA_model/lookup/Metier_lvl4_lookup.xlsx")
library(readxl)
Country_Lookup <- read_xlsx("CelticSea/FLBEIA_model/lookup/Country_lookup.xlsx")
Country_Lookup <- read_xlsx("lookup/Country_lookup.xlsx")
lvl4_Lookup <- read_xlsx("lookup/Metier_lvl4_lookup.xlsx")
area_spp_fix <- read.csv("lookup/Area_lookup.csv")
##Apply area fix
names(area_spp_fix) <- c("Area" ,"Standard","ICES_mix_correct", "ICES_FU","species_mix_FU" )
area_spp_fix$Area <- as.character(area_spp_fix$Area)
area_spp_fix <- area_spp_fix %>% filter(is.na(area_spp_fix$species_mix_FU)==F)
intercatch_with_dist$Area <- as.character(intercatch_with_dist$Area)
dim(intercatch_with_dist)
new_intercatch <- left_join(intercatch_with_dist,area_spp_fix, by = "Area" )
dim(intercatch_with_dist)[1]-dim(new_intercatch)[1]
##Check for NA values for the coloums added by area_spp_fix
table(is.na(new_intercatch$species_mix_FU[new_intercatch$Species =="NEP"]))
new_intercatch <- left_join(intercatch_with_dist,area_spp_fix, by = "Area" )
dim(intercatch_with_dist)[1]-dim(new_intercatch)[1]
##Check for NA values for the coloums added by area_spp_fix
table(is.na(new_intercatch$species_mix_FU[new_intercatch$Species =="NEP"]))
# #make columes for cleaning
new_intercatch$Area_keep <- new_intercatch$ICES_mix_correct
new_intercatch$Area_keep <- ifelse(new_intercatch$Species=="NEP",new_intercatch$Area_keep,new_intercatch$Area)
new_intercatch$species_mix_FU <- as.character(new_intercatch$species_mix_FU)
new_intercatch$Species_keep <- ifelse(new_intercatch$Species=="NEP",new_intercatch$species_mix_FU,new_intercatch$Species)
#### apply level 4 fix
names(new_intercatch)
names(lvl4_Lookup)
dim(new_intercatch)
new_intercatch2 <- left_join(new_intercatch,lvl4_Lookup)
dim(new_intercatch2)[1]-dim(new_intercatch)[1]
new_intercatch2$lvl4[is.na(new_intercatch2$Correct_lvl4)==F] <- new_intercatch2$Correct_lvl4[is.na(new_intercatch2$Correct_lvl4)==F]
new_intercatch2 <- new_intercatch2 %>% select(-Correct_lvl4)
table(new_intercatch2$lvl4)
table(new_intercatch2$lvl4)
dim(new_intercatch2)
new_intercatch3 <- left_join(new_intercatch2,Country_Lookup)
dim(new_intercatch3)-dim(new_intercatch3)
new_intercatch3$Country[is.na(new_intercatch3$CorrectCountry)==F] <- new_intercatch3$CorrectCountry[is.na(new_intercatch3$CorrectCountry)==F]
new_intercatch3 <- new_intercatch3 %>% select(-CorrectCountry)
table(new_intercatch3$Country)
Data_path
rm(list=ls()[!ls() %in% c("Data_path","Data_path_out")])
gc()
rm(list = ls())
library(readxl)
library(tidyr)
library(dplyr)
library(icesTAF)
library(ggplot2)
# Data_path <- "CelticSea/bootstrap"
# Data_path_out <- "CelticSea/Results"
taf.unzip("bootstrap/data/ices_intercatch/2019 06 22 WGMIXFISH CANUM WECA for stocks with distributions all WG 2002 2019.zip", files="2019 06 22 WGMIXFISH CANUM WECA for stocks with distributions all WG 2002 2019.csv", exdir="CelticSea/bootstrap/data/ices_intercatch")
#NB gitignore this file as it is too big
intercatch_with_dist <-  read.csv(file = "data/ices_intercatch/2019 06 22 WGMIXFISH CANUM WECA for stocks with distributions all WG 2002 2019.csv"),fileEncoding = "UTF-8-BOM")
#NB gitignore this file as it is too big
intercatch_with_dist <-  read.csv(file = "data/ices_intercatch/2019 06 22 WGMIXFISH CANUM WECA for stocks with distributions all WG 2002 2019.csv",fileEncoding = "UTF-8-BOM")
#NB gitignore this file as it is too big
intercatch_with_dist <-  read.csv("data/ices_intercatch/2019 06 22 WGMIXFISH CANUM WECA for stocks with distributions all WG 2002 2019.csv",fileEncoding = "UTF-8-BOM")
#NB gitignore this file as it is too big
intercatch_with_dist <-  read.csv(file = file.path("bootstrap/data/ices_intercatch/2019 06 22 WGMIXFISH CANUM WECA for stocks with distributions all WG 2002 2019.csv"),fileEncoding = "UTF-8-BOM")
getwd()
#NB gitignore this file as it is too big
intercatch_with_dist <-  read.csv(file = file.path("/bootstrap/data/ices_intercatch/2019 06 22 WGMIXFISH CANUM WECA for stocks with distributions all WG 2002 2019.csv"),fileEncoding = "UTF-8-BOM")
#NB gitignore this file as it is too big
intercatch_with_dist <-  read.csv(file = file.path("bootstrap/data/ices_intercatch/2019 06 22 WGMIXFISH CANUM WECA for stocks with distributions all WG 2002 2019.csv"),fileEncoding = "UTF-8-BOM")
getwd()
taf.unzip("bootstrap/data/ices_intercatch/2019 06 22 WGMIXFISH CANUM WECA for stocks with distributions all WG 2002 2019.zip", files="2019 06 22 WGMIXFISH CANUM WECA for stocks with distributions all WG 2002 2019.csv", exdir="bootstrap/data/ices_intercatch")
#NB gitignore this file as it is too big
intercatch_with_dist <-  read.csv(file = file.path("bootstrap/data/ices_intercatch/2019 06 22 WGMIXFISH CANUM WECA for stocks with distributions all WG 2002 2019.csv"),fileEncoding = "UTF-8-BOM")
View(intercatch_with_dist)
gc()
rm(list = ls())
library(readxl)
library(tidyr)
library(dplyr)
library(icesTAF)
library(ggplot2)
taf.unzip("bootstrap/data/ices_intercatch/bootstrap/initial/ices_intercatch/2020 06 22 WGMIXFISH CATON Stocks with distributions all WG 2002  2019.zip", files="2020 06 22 WGMIXFISH CATON stocks with distributions all WG 2002 2019.csv", exdir="bootstrap/data/ices_intercatch")
getwd()
# Data prep
# Preprocess data,
## Before: InterCatch extraction, data raised external to InterCatch, and ALK's
## After:  Discards rates and age structure
# 00 - Setup ####
gc()
rm(list = ls())
library(readxl)
library(tidyr)
library(dplyr)
library(icesTAF)
library(ggplot2)
taf.unzip("bootstrap/data/ices_intercatch/bootstrap/initial/ices_intercatch/2020 06 22 WGMIXFISH CATON Stocks with distributions all WG 2002  2019.zip", files="2020 06 22 WGMIXFISH CATON stocks with distributions all WG 2002 2019.csv", exdir="bootstrap/data/ices_intercatch")
# 01 - Calculating discard rates ####
# This is done using the CATON files from Intercatch extract and data raised external to InterCatch
taf.unzip("bootstrap/data/ices_intercatch/bootstrap/initial/ices_intercatch/2020 06 22 WGMIXFISH CATON Stocks with distributions all WG 2002  2019.zip", files="2020 06 22 WGMIXFISH CATON stocks with distributions all WG 2002 2019.csv", exdir="bootstrap/data/ices_intercatch")
# 01 - Calculating discard rates ####
# This is done using the CATON files from Intercatch extract and data raised external to InterCatch
taf.unzip("bootstrap/data/ices_intercatch/bootstrap/initial/ices_intercatch/2020 06 22 WGMIXFISH CATON Stocks with distributions all WG 2002  2019.zip", files="2020 06 22 WGMIXFISH CATON stocks with distributions all WG 2002 2019.csv", exdir="bootstrap/data/ices_intercatch")
# 01 - Calculating discard rates ####
# This is done using the CATON files from Intercatch extract and data raised external to InterCatch
taf.unzip("bootstrap/data/ices_intercatch/bootstrap/initial/ices_intercatch/2020 06 22 WGMIXFISH CATON Stocks with distributions all WG 2002  2019.zip", files="2020 06 22 WGMIXFISH CATON stocks with distributions all WG 2002 2019.csv", exdir="bootstrap/data/ices_intercatch")
# 01 - Calculating discard rates ####
# This is done using the CATON files from Intercatch extract and data raised external to InterCatch
taf.unzip("bootstrap/data/ices_intercatch/2020 06 22 WGMIXFISH CATON Stocks with distributions all WG 2002  2019.zip", files="2020 06 22 WGMIXFISH CATON stocks with distributions all WG 2002 2019.csv", exdir="bootstrap/data/ices_intercatch")
#NB gitignore this file as it is too big
intercatch_with_dist <-  read.csv(file = file.path("bootstrap/data/ices_intercatch/2020 06 22 WGMIXFISH CATON stocks with distributions all WG 2002 2019.csv"),fileEncoding = "UTF-8-BOM")
sort(unique(intercatch_with_dist$Area
))
# ~ Area ####
# check <- intercatch_with_dist %>% filter(!Area %in% c("27.7"  , "27.7.b" , "27.7.c","27.7.c.1","27.7.c.2" , "27.7.d",  "27.7.e",  "27.7.f" , "27.7.g" , "27.7.h",  "27.7.j","27.7.j.1","27.7.j.2" , "27.7.k","27.7.k.1","27.7.k.2" ))
# unique(check$Area)
# rm(check)
area_spp_fix <- read.csv("bootstrap/data/supporting_files/Area_lookup.csv")
names(area_spp_fix)
str(area_spp_fix$Area)
class(area_spp_fix$Area)
# ~ Area ####
# check <- intercatch_with_dist %>% filter(!Area %in% c("27.7"  , "27.7.b" , "27.7.c","27.7.c.1","27.7.c.2" , "27.7.d",  "27.7.e",  "27.7.f" , "27.7.g" , "27.7.h",  "27.7.j","27.7.j.1","27.7.j.2" , "27.7.k","27.7.k.1","27.7.k.2" ))
# unique(check$Area)
# rm(check)
area_spp_fix <- read.csv("bootstrap/data/supporting_files/Area_lookup.csv")
names(area_spp_fix) <- c("Area" ,"Standard","ICES_mix_correct", "ICES_FU","species_mix_FU" )
class(area_spp_fix$Area)
sessionInfo()
